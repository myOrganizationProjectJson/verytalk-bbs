<?php// 本文档自动生成，仅供测试运行class EmailAction extends Action{    private function index(){       $this->display();    }    /**     * 调用并循环发送     */    public function wantsend(){        if($_POST){          $subject= $_POST['subject'];          $message= $_POST['message'];          if($_POST['rand']){              $rand=$_POST['rand'];          }else{              $rand='';          }           if($_POST['member']){               $member=$_POST['member'];           }else{               $member=1;           }           set_time_limit(0);      for($i=0;$i<$member;$i++){                      $return=$this->sendemail($subject,$message,$rand);            print_r($return);            echo "<br/>";            flush();            ob_flush();            sleep(5);        }       }else{            $this->assign('post',$_POST);            $this->display();        }    }    /**     * 发送邮件     */    private function sendemail($subject='',$message='',$rand=''){        Vendor('mail');        $time=time();        if($rand==''){          $rand=$this->randemail();        }        if($rand==''){              $result=array(                  'error'=>'邮箱错误 toemail:'.$rand,
              );            return $result;        }        if(empty($subject)){            $result=array(                'error'=>'标题错误 subject:'.$subject,            );            return $result;        }        if(empty($message)){            $result=array(                'error'=>'内容错误 message:'.$message,            );            return $result;        }        $sendemail=new sendmail($rand, $subject, $message);        if($sendemail){            $this->savelog($rand,'发送成功',$time);            $result=array(                'sucess'=>'发送成功',                'toemail'=>$rand            );            return $result;                    }else{            $this->savelog($rand,'发送失败',$time);             $result=array(                'sucess'=>'发送失败',                'toemail'=>$rand            );             return $result;        }            }    /**     * 随机生成qqemail     */    private function randemail(){        @$qq= mt_rand(1,9);        for($qqs=0;$qqs<8;$qqs++){            @$qq.= mt_rand(0,9);        }        $qq=$qq.'@qq.com';        return $qq;    }    public function savelog($toemail,$info,$time,$status){        $status=1;        $id= M('RandEmail')->field('max(id)')->find();        $id=$id['max(id)']+1;        $sql="INSERT INTO `pre_rand_email` (        `id`,        `toemail`,        `info`,        `time`,        `status`        )        VALUES        (        '$id',        '$toemail',        '$info',        '$time',        '$status'        );        ";        M()->query($sql);    }      /**     * 查看日志     */    public function seelog(){        $times=time()-86400;        $time=time();        $condition ['time'] = array('between', array($times, $time));        $result= M('RandEmail')->where($condition)->limit(30)->select();        $this->assign('data',$result);        $this->display();    }    public function seelogajax(){        $times=time()-86400;        $condition ['time'] = array('between',array($times,time()));        $result= M('RandEmail')->where($condition)->limit(30)->select();$html= "<table>     <tr>	      <th>id</th>	      <th>toemail</th>	      <th>info</th>	      <th>time</th>	      <th>status</th>     </tr>";        foreach($result as $r){            $id=$r['id'];            $toemail=$r['toemail'];            $info=$r['info'];            $time=$r['time'];            $times=date("Y-m-d H:i:s", $time);            $status=$r['status'];            $html.=<<<html      <tr>	      <td>$id</td>	      <td>$toemail</td>	      <td>$info</td>	      <td>$times</td>	      <td>$status</td>     </tr>html;        }    $html.=  '</table>';           echo $html;    }}?>